# üîç –ü–æ—á–µ–º—É –∫–æ–¥ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

## –ü—Ä–æ–±–ª–µ–º–∞
GitHub Actions –ø–æ–∫–∞–∑—ã–≤–∞–ª —É—Å–ø–µ—à–Ω—ã–π –¥–µ–ø–ª–æ–π, –Ω–æ –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ—Å—Ç–∞–≤–∞–ª—Å—è —Å—Ç–∞—Ä—ã–º.

## –ü—Ä–∏—á–∏–Ω—ã

### 1. ‚ö†Ô∏è Docker –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤ —Å —Ç–µ–≥–æ–º `:latest`
Docker –Ω–µ –≤—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç –æ–±—Ä–∞–∑—ã —Å —Ç–µ–≥–æ–º `latest` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ö–æ–≥–¥–∞ –≤—ã –¥–µ–ª–∞–µ—Ç–µ:
```bash
docker pull image:latest
docker-compose up -d
```

Docker Compose –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ª–æ–∫–∞–ª—å–Ω–æ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π** –æ–±—Ä–∞–∑ –≤–º–µ—Å—Ç–æ —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ.

### 2. ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–ª–∞–≥–∞ `--force-recreate`
–ö–æ–º–∞–Ω–¥–∞ `docker-compose up -d` –±–µ–∑ —Ñ–ª–∞–≥–æ–≤:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –ï—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å, **–Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**
- –î–∞–∂–µ –µ—Å–ª–∏ –æ–±—Ä–∞–∑ –æ–±–Ω–æ–≤–∏–ª—Å—è!

### 3. ‚ö†Ô∏è –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥
–°—Ç–∞—Ä–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
```bash
docker pull image:latest          # –ó–∞–≥—Ä—É–∂–∞–µ—Ç –æ–±—Ä–∞–∑
docker-compose down               # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up -d              # ‚ùå –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–∑ –∏–∑ –∫–µ—à–∞!
```

### 4. ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–µ—Ä—Å–∏–π
–ù–µ –±—ã–ª–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
- –ö–∞–∫–∏–µ –æ–±—Ä–∞–∑—ã –±—ã–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
- –ö–æ–≥–¥–∞ –æ–Ω–∏ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã
- –ö–∞–∫–∏–µ –æ–±—Ä–∞–∑—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö

## –†–µ—à–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `.github/workflows/deploy.yml`:

#### 1. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –ø–µ—Ä–µ–¥ pull
```bash
docker rmi ghcr.io/grigra27/fair_sber_price-web:latest || true
docker rmi ghcr.io/grigra27/fair_sber_price-bot:latest || true
```
–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —Å–≤–µ–∂–∏–π –æ–±—Ä–∞–∑.

#### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `docker-compose pull`
```bash
docker-compose -f docker-compose.prod.yml pull --ignore-pull-failures
```
–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–∑—ã —á–µ—Ä–µ–∑ docker-compose.

#### 3. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```bash
docker-compose up -d --force-recreate --remove-orphans
```
–§–ª–∞–≥–∏:
- `--force-recreate` - –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–∞–∂–µ –µ—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
- `--remove-orphans` - —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

#### 4. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
```bash
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫–∏–µ –æ–±—Ä–∞–∑—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
docker images | grep fair_sber_price

# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –æ–±—Ä–∞–∑–∞–º–∏
docker ps --format "table {{.Names}}\t{{.Image}}\t{{.Status}}"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞ –æ–±—Ä–∞–∑—ã –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.CreatedAt}}"
```

## –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–ø–ª–æ—è

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down --remove-orphans

# 2. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ –Ω–∞–¥–µ–∂–Ω–æ)
docker rmi image:latest || true

# 3. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–µ–∂–∏–µ –æ–±—Ä–∞–∑—ã —á–µ—Ä–µ–∑ docker-compose
docker-compose pull

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ–º
docker-compose up -d --force-recreate --remove-orphans

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã
docker ps
docker images
```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SHA –≤–º–µ—Å—Ç–æ `:latest`
–í–º–µ—Å—Ç–æ:
```yaml
image: ghcr.io/grigra27/fair_sber_price-web:latest
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
```yaml
image: ghcr.io/grigra27/fair_sber_price-web:sha-abc123
```

–ü–ª—é—Å—ã:
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

–ú–∏–Ω—É—Å—ã:
- –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å docker-compose.yml –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `imagePullPolicy: Always`
–í Kubernetes –µ—Å—Ç—å —Ç–∞–∫–∞—è –æ–ø—Ü–∏—è, –Ω–æ –≤ Docker Compose –µ—ë –Ω–µ—Ç.

### –í–∞—Ä–∏–∞–Ω—Ç 3: Watchtower (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Watchtower –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
```yaml
watchtower:
  image: containrrr/watchtower
  volumes:
    - /var/run/docker.sock:/var/run/docker.sock
  command: --interval 300
```

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–µ–ø–ª–æ–π —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü–æ—Å–ª–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø—É—à–∞ –≤ GitHub:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ GitHub Actions - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ–±—Ä–∞–∑–∞—Ö
2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
cd /opt/fair-sber-price
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.CreatedAt}}" | grep fair_sber_price
```
3. –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –≤—Ä–µ–º–µ–Ω–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—É—à–∞

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–æ–±–∞–≤—å—Ç–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–≥–∏ —Å –≤–µ—Ä—Å–∏—è–º–∏ (v1.0.0, v1.0.1)
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –Ω–µ—É–¥–∞—á–Ω—ã–µ –¥–µ–ø–ª–æ–∏
3. **Rollback** - —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏ –æ–±—Ä–∞–∑–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–∞—Ç–∞
4. **Health checks** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ health checks –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —á—Ç–æ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–°–¥–µ–ª–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:
```bash
# –î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –ª—é–±–æ–π —Ñ–∞–π–ª
echo "# Test deployment $(date)" >> fsp/manage.py

# –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏ –∑–∞–ø—É—à—å—Ç–µ
git add .
git commit -m "test: verify deployment works"
git push origin main
```

–ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–æ–≤—ã–π timestamp
docker images | grep fair_sber_price

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω—ã
docker ps --format "table {{.Names}}\t{{.Status}}"
```
